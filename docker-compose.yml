version: "3.5"

networks:
    proxy:
        name: proxy
    nextcloud:
    gitea:
    authelia:
    bookstack:
    wekan:
    exporters:
    portus:
    grafana:
    loki:

volumes:
    nextcloud:
    jenkinsdata:
    portainer_data:
    bookstack:
    statping_data:

services:
    # ###############################
    # #       Cloudflare DDNS       #
    # ###############################
    # cloudflare-ddns:
    #     image: oznu/cloudflare-ddns:latest
    #     container_name: cloudflare-ddns
    #     logging:
    #         driver: "loki"
    #         options:
    #             loki-url: "http://localhost:3100/loki/api/v1/push"
    #     restart: unless-stopped
    #     environment:
    #         - API_KEY=${CLOUDFLARE_DDNS_API_KEY}
    #         - ZONE=${ROOT_DOMAIN}
    #         - PROXIED=true

    # ###############################
    # #          Watchtower         #
    # ###############################
    # watchtower:
    #     image: containrrr/watchtower
    #     container_name: watchtower
    #     logging:
    #         driver: "loki"
    #         options:
    #             loki-url: "http://localhost:3100/loki/api/v1/push"
    #     command: -H tcp://dockerproxy:2375
    #     depends_on:
    #         - smtp
    #     networks:
    #         - proxy
    #     environment:
    #         - WATCHTOWER_MONITER_ONLY=true
    #         - WATCHTOWER_NOTIFICATIONS=email
    #         - WATCHTOWER_NOTIFICATION_EMAIL_FROM=notifications@${ROOT_DOMAIN}
    #         - WATCHTOWER_NOTIFICATION_EMAIL_TO=${NOTIFICATIONS_EMAIL:?Email required for Watchtower email notifications}
    #         - WATCHTOWER_NOTIFICATION_EMAIL_SERVER=smtp
    #         - WATCHTOWER_NOTIFICATION_EMAIL_SERVER_TLS_SKIP_VERIFY=true
    #         - WATCHTOWER_NOTIFICATION_EMAIL_SERVER_PORT=587
    #         - TZ
            
    ###############################
    #          Librespeed         #
    ###############################
    librespeed:
        image: adolfintel/speedtest
        container_name: librespeed
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        environment:
            - TITLE=Librespeed
            - TELEMETRY=true
            - ENABLE_ID_OBFUSCATION=true
            - REDACT_IP_ADDRESSES=true
            - PASSWORD=${LIBRESPEED_PASSWORD}
            - EMAIL=${NOTIFICATIONS_EMAIL}
            - IPINFO_APIKEY
        networks:
            - proxy
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.speedtest.rule=Host(`speedtest.${ROOT_DOMAIN}`)"
            - "traefik.http.routers.speedtest.entrypoints=secure"
            - "traefik.http.routers.speedtest.tls=true"

    ###############################
    #          SMTP               #
    ###############################
    smtp:
        image: boky/postfix
        container_name: smtp
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        restart: unless-stopped
        networks:
            - proxy
        environment:
            - HOSTNAME=smtp
            - RELAYHOST=${SMTP_DOMAIN}:587
            - RELAYHOST_USERNAME=${SMTP_USERNAME}
            - RELAYHOST_PASSWORD=${SMTP_PASSWORD}
            - ALLOWED_SENDER_DOMAINS=${ROOT_DOMAIN}

    ###############################
    #          cAdvisor           #
    ###############################
    cadvisor:
        image: google/cadvisor
        container_name: cadvisor
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        volumes:
            - /:/rootfs:ro
            - /var/run:/var/run:ro
            - /sys:/sys:ro
            - /var/lib/docker/:/var/lib/docker:ro
            - /dev/disk/:/dev/disk:ro
        networks:
            - exporters
        expose:
            - "8080"
        ports:
            - "8700:8080"

    ###############################
    #          Prometheus         #
    ###############################

    prometheus:
        image: prom/prometheus
        container_name: prometheus
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        restart: unless-stopped
        networks:
            - proxy
            - exporters
        volumes:
            - ./configs/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.prometheus.rule=Host(`metrics.${ROOT_DOMAIN}`)"
            - "traefik.http.routers.prometheus.entrypoints=secure"
            - "traefik.http.routers.prometheus.middlewares=authelia@file"
            - "traefik.http.services.prometheus.loadbalancer.server.port=9090"
            - "traefik.http.routers.prometheus.tls=true"

    node-exporter:
        image: prom/node-exporter
        container_name: node-exporter
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        networks:
            - exporters

    ###############################
    #          Grafana            #
    ###############################

    grafana:
        image: grafana/grafana
        container_name: grafana
        user: ${UID}:${GID}
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        networks:
            - proxy
            - grafana
        environment:
            - LDAP_LOGIN_BASE
            - LDAP_READONLY_PASSWORD
            - GF_ANALYTICS_REPORTING_ENABLED=false
            - GF_SECURITY_ADMIN_USER=admin
            - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_ADMIN_PASSWORD}
            - GF_REMOTE_CACHE_TYPE=redis
            - GF_REMOTE_CACHE_CONNSTR=addr=grafana-cache:6379,pool_size=100,db=0,ssl=false
            - GF_AUTH_LDAP_ENABLED=true
            - GF_AUTH_LDAP_ALLOW_SIGN_UP=true
            - GF_AUTH_LDAP_CONFIG_FILE=/etc/grafana/ldap.toml
            - GF_SMTP_ENABLED=true
            - GF_SMTP_HOST=smtp:587
            - GF_SMTP_FROM_ADDRESS=notifications@${ROOT_DOMAIN}
            - GF_SMTP_FROM_NAME=Grafana
            - GF_SMTP_EHLO_INDENTITY=graphs.${ROOT_DOMAIN}
        volumes:
            - ${SERVICES_ROOT}/${GRAFANA_ROOT:-grafana}:/var/lib/grafana
            - ./configs/grafana/ldap.toml:/etc/grafana/ldap.toml
            - ./configs/grafana/provisioning:/etc/grafana/provisioning
            - ./configs/grafana/dashboards:/var/lib/grafana/dashboards
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.grafana.rule=Host(`graphs.${ROOT_DOMAIN}`)"
            - "traefik.http.routers.grafana.entrypoints=secure"
            - "traefik.http.services.grafana.loadbalancer.server.port=3000"
            - "traefik.http.routers.grafana.tls=true"

    grafana-cache:
        image: redis:alpine
        container_name: grafana-cache
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        environment:
            - TZ
        expose:
            - 6379
        restart: unless-stopped
        networks:
            - grafana

    # ###############################
    # #     docker-socket-proxy     #
    # ###############################

    dockerproxy:
        image: tecnativa/docker-socket-proxy
        container_name: dockerproxy
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        restart: unless-stopped
        environment:
            - POST=1
            - BUILD=1
            - CONTAINERS=1
            - EXEC=1
            - IMAGES=1
            - INFO=1
            - NETWORKS=1
            - SESSION=1
            - SWARM=1
            - SYSTEM=1
            - VOLUMES=1
            - TZ
        networks:
            - proxy
        ports:
            - 2375
        volumes:
            - "/var/run/docker.sock:/var/run/docker.sock"

    ###############################
    #           Portainer         #
    ###############################
    # # # https://github.com/portainer/portainer/issues/3125
    portainer:
        image: portainer/portainer
        container_name: portainer
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        command: -H tcp://dockerproxy:2375
        restart: unless-stopped
        networks:
            - proxy
        volumes:
            - portainer_data:/data
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.portainer.rule=Host(`containers.${ROOT_DOMAIN}`)"
            - "traefik.http.routers.portainer.entrypoints=secure"
            - "traefik.http.services.portainer.loadbalancer.server.port=9000"
            - "traefik.http.routers.portainer.tls=true"

    # ###############################
    # #           Authelia          #
    # ###############################

    authelia:
        image: authelia/authelia
        container_name: authelia
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        depends_on:
            - authelia-cache
            - authelia-db
        volumes:
            - ${SERVICES_ROOT}/${AUTHELIA_ROOT:-authelia}/core:/var/lib/authelia
            - ./configs/authelia/configuration.yml:/etc/authelia/configuration.yml:ro
        expose:
            - 9091
        networks:
            - proxy
            - authelia
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.authelia.rule=Host(`logins.${ROOT_DOMAIN}`)"
            - "traefik.http.routers.authelia.entrypoints=secure"
            - "traefik.http.routers.authelia.tls=true"
        restart: unless-stopped
        environment:
            - AUTHELIA_SESSION_SECRET
            - AUTHELIA_JWT_SECRET
            - AUTHELIA_AUTHENTICATION_BACKEND_LDAP_PASSWORD=${LDAP_ADMIN_PASSWORD}
            - AUTHELIA_STORAGE_POSTGRES_PASSWORD
            - TZ

    authelia-cache:
        image: redis:alpine
        container_name: authelia-cache
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        environment:
            - TZ
        expose:
            - 6379
        restart: unless-stopped
        networks:
            - authelia

    authelia-db:
        image: postgres:12-alpine
        container_name: authelia-db
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        restart: unless-stopped
        expose:
            - 5432
        networks:
            - authelia
        environment:
            - POSTGRES_DB=authelia
            - POSTGRES_USER=authelia
            - POSTGRES_PASSWORD=${AUTHELIA_STORAGE_POSTGRES_PASSWORD:?Please set a password for the Authelia Postgres container}
            - TZ
        volumes:
            - ${SERVICES_ROOT}/${AUTHELIA_ROOT:-authelia}/db:/var/lib/postgresql/data

    ###############################
    #           Traefik           #
    ###############################

    traefik:
        image: traefik:latest
        container_name: traefik
        restart: unless-stopped
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        environment:
            - TZ
        env_file:
            - .env
            - configs/traefik/providers.env
        command:
            - --certificatesresolvers.le.acme.email=${NOTIFICATIONS_EMAIL:?Please supply LetsEncrypt with an email}
        labels:
            - "traefik.enable=true"
        networks:
            - proxy
        ports:
            - "${TRAEFIK_HTTP_PORT:-80}:80"
            - "${TRAEFIK_HTTPS_PORT:-443}:443"
        volumes:
            - ./configs/traefik/static.yml:/traefik.yml
            - ./configs/traefik/dynamic.yml:/dynamic.yml
            - ${SERVICES_ROOT}/${TRAEFIK_ROOT:-traefik}/le:/le

    ###############################
    #           OpenLDAP          #
    ###############################

    openldap:
        image: osixia/openldap:1.3.0
        container_name: openldap
        restart: unless-stopped
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        environment:
            - LDAP_RFC2307BIS_SCHEMA=true
            - LDAP_ORGANISATION
            - LDAP_DOMAIN=${ROOT_DOMAIN}
            - LDAP_ADMIN_PASSWORD
            - LDAP_CONFIG_PASSWORD
            - LDAP_BASE_DN=${LDAP_LOGIN_BASE}
            - LDAP_READONLY_USER=true
            - LDAP_READONLY_USER_USERNAME=readonly
            - LDAP_READONLY_USER_PASSWORD
            - LDAP_TLS_ENFORCE=false
            - TZ
        volumes:
            - ./configs/openldap/seeds:/container/service/slapd/assets/config/bootstrap/ldif/custom
            - ${SERVICES_ROOT}/${OPENLDAP_ROOT:-openldap}/db:/var/lib/ldap
            - ${SERVICES_ROOT}/${OPENLDAP_ROOT:-openldap}/config:/etc/ldap/slapd.d
        ports:
            - "389:389"
            - "636:636"
        networks:
            - proxy
        command: --copy-service

    ###############################
    #       PHPLDAPAdmin          #
    ###############################

    phpldapadmin:
        image: osixia/phpldapadmin
        container_name: phpldapadmin
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        restart: unless-stopped
        hostname: admin.${ROOT_DOMAIN}
        networks:
            - proxy
        environment:
            PHPLDAPADMIN_HTTPS: "false"
            PHPLDAPADMIN_LDAP_HOSTS: "#PYTHON2BASH:[
                {'openldap': [
                {'server': [{'tls': False}]},
                {'login': [
                {'bind_id': 'cn=admin,${LDAP_LOGIN_BASE}'},
                {'bind_pass': '${LDAP_ADMIN_PASSWORD}'},
                {'attr': 'cn'}
                ]
                }]}]"
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.phpldapadmin.rule=Host(`admin.${ROOT_DOMAIN}`)"
            - "traefik.http.routers.phpldapadmin.entrypoints=secure"
            - "traefik.http.routers.phpldapadmin.tls=true"

    ###############################
    #           loki           #
    ###############################
    loki:
        image: grafana/loki:latest
        container_name: loki
        ports:
            - "3100:3100"
        command: -config.file=/etc/loki/local-config.yaml
        networks:
            - proxy
            - loki

    ###############################
    #           Nextcloud         #
    ###############################
    nextcloud-server:
        image: nginx:alpine
        restart: unless-stopped
        container_name: nextcloud-server
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        depends_on:
            - nextcloud-data
        volumes:
            - nextcloud:/var/www/html:ro
            - ./configs/nextcloud/nginx.conf:/etc/nginx/nginx.conf:ro
            - ${SERVICES_ROOT}/${NEXTCLOUD_ROOT:-nextcloud}/data:/var/www/html/data
            - ${SERVICES_ROOT}/${NEXTCLOUD_ROOT:-nextcloud}/config:/var/www/html/config
            - ${SERVICES_ROOT}/${NEXTCLOUD_ROOT:-nextcloud}/custom_apps:/var/www/html/custom_apps
            - ${SERVICES_ROOT}/${NEXTCLOUD_ROOT:-nextcloud}/themes:/var/www/html/themes
        environment:
            - TZ
        networks:
            - proxy
            - nextcloud
        labels:
            - "traefik.enable=true"
            - "traefik.http.services.nextcloud.loadbalancer.server.port=80"
            - "traefik.http.middlewares.nextcloud-caldav.redirectregex.permanent=true"
            - "traefik.http.middlewares.nextcloud-caldav.redirectregex.regex=^https://(.*)/.well-known/(card|cal)dav"
            - "traefik.http.middlewares.nextcloud-caldav.redirectregex.replacement=https://$${1}/remote.php/dav/"
            - "traefik.http.routers.nextcloud.middlewares=nextcloud-caldav@docker"
            - "traefik.http.routers.nextcloud.entrypoints=secure"
            - "traefik.http.routers.nextcloud.rule=Host(`cloud.${ROOT_DOMAIN}`)"
            - "traefik.http.routers.nextcloud.tls=true"

    nextcloud-data:
        image: nextcloud:18-fpm-alpine
        restart: unless-stopped
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        container_name: nextcloud
        networks:
            - proxy
            - nextcloud
        depends_on:
            - nextcloud-db
            - nextcloud-cache
        volumes:
            - nextcloud:/var/www/html
            - ${SERVICES_ROOT}/${NEXTCLOUD_ROOT:-nextcloud}/data:/var/www/html/data
            - ${SERVICES_ROOT}/${NEXTCLOUD_ROOT:-nextcloud}/config:/var/www/html/config
            - ${SERVICES_ROOT}/${NEXTCLOUD_ROOT:-nextcloud}/custom_apps:/var/www/html/custom_apps
            - ${SERVICES_ROOT}/${NEXTCLOUD_ROOT:-nextcloud}/themes:/var/www/html/themes
        environment:
            - NEXTCLOUD_ADMIN_USER
            - NEXTCLOUD_ADMIN_PASSWORD
            - POSTGRES_USER=nextcloud
            - POSTGRES_PASSWORD=${NEXTCLOUD_DB_PASSWORD}
            - POSTGRES_HOST=nextcloud-db
            - POSTGRES_DB=nextcloud
            - NEXTCLOUD_HOSTNAME=cloud.${ROOT_DOMAIN}
            - NEXTCLOUD_TRUSTED_DOMAINS=cloud.${ROOT_DOMAIN} localhost
            - REDIS_HOST=nextcloud-cache
            - SMTP_HOST=smtp
            - SMTP_AUTH_TYPE=NONE
            - SMTP_PORT=587
            - MAIL_FROM_ADDRESS=notifications@${ROOT_DOMAIN}
            - TZ

    nextcloud-db:
        image: postgres:12-alpine
        container_name: nextcloud-db
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        restart: unless-stopped
        networks:
            - nextcloud
        ports:
            - "5432:5432"
        environment:
            - POSTGRES_DB=nextcloud
            - POSTGRES_USER=nextcloud
            - POSTGRES_PASSWORD=${NEXTCLOUD_DB_PASSWORD}
            - TZ
        volumes:
            - ${SERVICES_ROOT}/${NEXTCLOUD_ROOT:-nextcloud}/db:/var/lib/postgresql/data

    nextcloud-cache:
        image: redis:alpine
        container_name: nextcloud-cache
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        restart: unless-stopped
        environment:
            - TZ
        networks:
            - nextcloud

    ###############################
    #           Emby              #
    ###############################
    # emby:
    #     image: linuxserver/emby
    #     container_name: emby
    #     restart: unless-stopped
    #     networks:
    #         - proxy
    #     environment:
    #         - PUID=1000
    #         - PGID=1000
    #         - TZ
    #     volumes:
    #         - ${SERVICES_ROOT}/${EMBY_ROOT:-emby}/media:/media:ro
    #         - ${SERVICES_ROOT}/${EMBY_ROOT:-emby}/transcoding:/transcoding:ro
    #         - ${SERVICES_ROOT}/${EMBY_ROOT:-emby}/config:/config
    #     devices:
    #         - /dev/dri:/dev/dri
    #     labels:
    #         - "traefik.enable=true"
    #         - "traefik.http.services.emby.loadbalancer.server.port=8096"
    #         - "traefik.http.routers.emby.rule=Host(`media.${ROOT_DOMAIN}`)"
    #         - "traefik.http.routers.emby.tls=true"
    #         - "traefik.http.routers.emby.entrypoints=secure"

    ###############################
    #           EmbyStats         #
    ###############################
    embystats:
        image:  uping/embystat:beta
        restart: unless-stopped
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        container_name: embystats
        volumes:
            - ${SERVICES_ROOT}/${EMBYSTATS_ROOT:-embystats}/config:/app/config
        networks:
            - proxy
        labels:
            - "traefik.enable=true"
            - "traefik.http.services.embystats.loadbalancer.server.port=6555"
            - "traefik.http.routers.embystats.rule=Host(`mediastats.${ROOT_DOMAIN}`)"
            - "traefik.http.routers.embystats.entrypoints=secure"
            - "traefik.http.routers.embystats.middlewares=authelia@file"
            - "traefik.http.routers.embystats.tls=true"

    ###############################
    #           Jellyfin          #
    ###############################
    jellyfin:
        image: jellyfin/jellyfin
        container_name: jellyfin
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        restart: unless-stopped
        networks:
            - proxy
        volumes:
            - ${MOVIES_ROOT}:/media/movies:ro
            - ${TV_ROOT}:/media/tv:ro
            - ${SERVICES_ROOT}/${JELLYFIN_ROOT:-jellyfin}/config:/config
        environment:
            - TZ
        labels:
            - "traefik.enable=true"
            - "traefik.http.services.jellyfin.loadbalancer.server.port=8096"
            - "traefik.http.routers.jellyfin.rule=Host(`media.${ROOT_DOMAIN}`)"
            - "traefik.http.routers.jellyfin.entrypoints=secure"
            - "traefik.http.routers.jellyfin.tls=true"

    ###############################
    #           Gitea             #
    ###############################
    gitea:
        image: gitea/gitea
        container_name: gitea
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        depends_on:
            - gitea-db
        environment:
            - USER_UID=${UID}
            - USER_GID=${GID}
            - ROOT_URL=https://git.${ROOT_DOMAIN}
            - APP_NAME=${GITEA_APP_NAME}
            - RUN_USER=${GITEA_RUN_USER:-git}
            - ENABLE_PUSH_CREATE_USER=true
            - ENABLE_PUSH_CREATE_ORG=true
            - DB_TYPE=postgres
            - DB_HOST=gitea-db:5432
            - DB_NAME=gitea
            - DB_USER=gitea
            - DB_PASSWD=${GITEA_DB_PASSWORD}
            - MAILER_ENABLED=true
            - MAILER_HOST=smtp
            - MAILER_FROM=notifications@{ROOT_DOMAIN}
            - MAILER_IS_TLS_ENABLED=false
            - TZ
        restart: unless-stopped
        networks:
            - proxy
            - gitea
        volumes:
            - ${SERVICES_ROOT}/${GITEA_ROOT:-gitea}/data:/data
            - ./configs/gitea:/data/gitea/conf
            - /etc/timezone:/etc/timezone:ro
            - /etc/localtime:/etc/localtime:ro
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.gitea.rule=Host(`git.${ROOT_DOMAIN}`)"
            - "traefik.http.services.gitea.loadbalancer.server.port=3000"
            - "traefik.http.routers.gitea.entrypoints=secure"
            - "traefik.http.routers.gitea.service=gitea-web-svc"
            - "traefik.http.services.gitea-web-svc.loadbalancer.server.port=3000"
            - "traefik.tcp.routers.gitea-ssh.rule=HostSNI(`*`)"
            - "traefik.tcp.routers.gitea-ssh.entrypoints=ssh"
            - "traefik.tcp.routers.gitea-ssh.service=gitea-ssh-svc"
            - "traefik.tcp.services.gitea-ssh-svc.loadbalancer.server.port=22"
            - "traefik.http.routers.gitea.tls=true"

    gitea-db:
        image: postgres:12-alpine
        container_name: gitea-db
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        restart: unless-stopped
        networks:
            - gitea
        environment:
            - POSTGRES_DB=gitea
            - POSTGRES_USER=gitea
            - POSTGRES_PASSWORD=${GITEA_DB_PASSWORD}
            - TZ
        volumes:
            - ${SERVICES_ROOT}/${GITEA_ROOT:-gitea}/db:/var/lib/postgresql/data

    ###############################
    #           Drone             #
    ###############################
    # drone:
    #     image: drone/drone:1
    #     container_name: drone
        # logging:
        #     driver: "loki"
        #     options:
        #         loki-url: "http://localhost:3100/loki/api/v1/push"
    #     restart: unless-stopped
    #     environment:
    #         - DRONE_GITEA_CLIENT_ID=${GITEA_CLIENT_ID}
    #         - DRONE_GITEA_CLIENT_SECRET=${GITEA_CLIENT_SECRET}
    #         - DRONE_GITEA_SERVER=http://gitea
    #         - DRONE_RPC_SECRET=${DRONE_RUNNER_SHARED_SECRET}
    #         - DRONE_SERVER_HOST=ci.${ROOT_DOMAIN}
    #         - DRONE_SERVER_PROTO=http
    #         - TZ
    #     networks:
    #         - proxy
    #     volumes:
    #         - ${SERVICES_ROOT}/${DRONE_ROOT:-drone}/home:/var/drone_home
    #     labels:
    #         - "traefik.enable=true"
    #         - "traefik.http.routers.drone.rule=Host(`ci.${ROOT_DOMAIN}`)"
    #         - "traefik.http.routers.drone.entrypoints=secure"
    #         - "traefik.http.routers.drone.tls=true"

    # drone-runner:
    #     image: drone/drone-runner-docker:1
        # logging:
        #     driver: "loki"
        #     options:
        #         loki-url: "http://localhost:3100/loki/api/v1/push"
    #     container_name: drone-runner-1
    #     restart: unless-stopped
    #     environment:
    #         - DRONE_RPC_HOST=drone
    #         - DRONE_RPC_PROTO=http
    #         - DRONE_RPC_SECRET=${DRONE_RUNNER_SHARED_SECRET}

    ###############################
    #           Portus            #
    ###############################
    portus:
        image: opensuse/portus:2.4
        container_name: portus
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        restart: unless-stopped
        environment:
            - PORTUS_CHECK_SSL_USAGE_ENABLED=false
            - PORTUS_SECRET_KEY_BASE
            - PORTUS_PASSWORD
            - PORTUS_KEY_PATH=/certificates/portus.key
            - CCONFIG_PREFIX=PORTUS
            - RAILS_SERVE_STATIC_FILES=true
            - PORTUS_EMAIL_FROM=notifications@${ROOT_DOMAIN}
            - PORTUS_EMAIL_NAME=Portus
            - PORTUS_EMAIL_REPLY_TO=notifications@${ROOT_DOMAIN}
            - PORTUS_EMAIL_SMTP_ENABLED=true
            - PORTUS_EMAIL_SMTP_ADDRESS=smtp
            - PORTUS_EMAIL_SMTP_DOMAIN=${ROOT_DOMAIN}
            - PORTUS_EMAIL_SMTP_PORT=587
            - PORTUS_LDAP_ENABLED=true
            - PORTUS_LDAP_HOSTNAME=openldap
            - PORTUS_LDAP_PORT=389
            - PORTUS_LDAP_UID=uid
            - PORTUS_LDAP_BASE=ou=people,${LDAP_LOGIN_BASE}
            - PORTUS_LDAP_AUTHENTICATION_ENABLED=true
            - PORTUS_LDAP_AUTHENTICATION_BIND_DN=cn=admin,${LDAP_LOGIN_BASE}
            - PORTUS_LDAP_AUTHENTICATION_PASSWORD=${LDAP_ADMIN_PASSWORD}
            - PORTUS_LDAP_GROUP_BASE=cn=dev,ou=groups,${LDAP_LOGIN_BASE}
            - PORTUS_LDAP_GUESS_EMAIL_ENALBED=true
            - PORTUS_LDAP_GUESS_EMAIL_ATTR=mail
            - PORTUS_DB_HOST=portus-db
            - PORTUS_DB_DATABASE=portus
            - PORTUS_DB_USERNAME=portus
            - PORTUS_DB_PASSWORD
            - PORTUS_MACHINE_FQDN_VALUE=registry.${ROOT_DOMAIN}
            - TZ
        networks:
            - proxy
            - portus
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.portus.rule=Host(`registry.${ROOT_DOMAIN}`)"
            - "traefik.http.services.portus.loadbalancer.server.port=3000"
            - "traefik.http.routers.portus.entrypoints=secure"
            - "traefik.http.routers.portus.tls=true"
    portus-db:
        image: linuxserver/mariadb
        container_name: portus-db
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        environment:
            - PUID=1000
            - PGID=1000
            - MYSQL_ROOT_PASSWORD=${PORTUS_DB_ADMIN_PASSWORD:?Admin password for portus-db must be set!}
            - MYSQL_DATABASE=portus
            - MYSQL_USER=portus
            - MYSQL_PASSWORD=${PORTUS_DB_PASSWORD:?User password for portus must be set!}
            - TZ
        volumes:
            - ${SERVICES_ROOT}/${PORTUS_ROOT:-portus}/db:/config
        networks:
            - portus
        restart: unless-stopped

    ###############################
    #           Bookstack         #
    ###############################
    bookstack:
        image: linuxserver/bookstack
        container_name: bookstack
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        environment:
            # - APP_DEBUG=true
            # - LDAP_DUMP_USER_DETAILS=true
            - APP_URL=https://wiki.${ROOT_DOMAIN}
            - PUID=1000
            - PGID=1000
            - DB_HOST=bookstack-db
            - DB_USER=bookstack
            - DB_PASS=${BOOKSTACK_DB_PASSWORD}
            - DB_DATABASE=bookstackapp
            - AUTH_METHOD=ldap
            - LDAP_SERVER=openldap
            - LDAP_BASE_DN=ou=people,${LDAP_LOGIN_BASE}
            - LDAP_DN=cn=admin,${LDAP_LOGIN_BASE}
            - LDAP_PASS=${LDAP_ADMIN_PASSWORD}
            - LDAP_USER_FILTER=(&(uid=$${user}))
            - LDAP_VERSION=3
            - LDAP_ID_ATTRIBUTE=uid
            - LDAP_EMAIL_ATTRIBUTE=mail
            - LDAP_DISPLAY_NAME_ATTRIBUTE=cn
            - LDAP_TLS_INSECURE=true
            - MAIL_DRIVER=smtp
            - MAIL_HOST=smtp
            - MAIL_PORT=587
            - MAIL_FROM=notifications@${ROOT_DOMAIN}
            - CACHE_DRIVER=redis
            - SESSION_DRIVER=redis
            - REDIS_SERVERS=bookstack-cache:6379:0
        volumes:
            - ${SERVICES_ROOT}/${BOOKSTACK_ROOT:-bookstack}/config:/config
        restart: unless-stopped
        expose:
            - 80
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.bookstack.rule=Host(`wiki.${ROOT_DOMAIN}`)"
            - "traefik.http.routers.bookstack.entrypoints=secure"
            - "traefik.http.routers.bookstack.tls=true"
        networks:
            - proxy
            - bookstack
        depends_on:
            - bookstack-db

    bookstack-db:
        image: linuxserver/mariadb
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        container_name: bookstack-db
        environment:
            - PUID=1000
            - PGID=1000
            - MYSQL_ROOT_PASSWORD=${BOOKSTACK_DB_ADMIN_PASSWORD:?Admin password for bookstack-db must be set!}
            - MYSQL_DATABASE=bookstackapp
            - MYSQL_USER=bookstack
            - MYSQL_PASSWORD=${BOOKSTACK_DB_PASSWORD:?User password for bookstack must be set!}
            - TZ
        volumes:
            - ${SERVICES_ROOT}/${BOOKSTACK_ROOT:-bookstack}/db:/config
        networks:
            - bookstack
        restart: unless-stopped

    bookstack-cache:
        image: redis:alpine
        container_name: bookstack-cache
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        environment:
            - TZ
        restart: unless-stopped
        networks:
            - bookstack

    ##############################
    #          Organizr          #
    ##############################
    organizr:
        image: organizrtools/organizr-v2
        container_name: organizr
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        environment:
            - PUID=1000
            - PGID=1000
            - TZ
        networks:
            - proxy
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.organizr.rule=Host(`startpage.${ROOT_DOMAIN}`)"
            - "traefik.http.routers.organizr.entrypoints=secure"
            - "traefik.http.routers.organizr.tls=true"
        volumes:
            - ${SERVICES_ROOT}/${ORGANIZR_ROOT:-organizr}/config:/config
            - ${SERVICES_ROOT}/${ORGANIZR_ROOT:-organizr}/db:/db
        restart: unless-stopped

    ###############################
    #           Ombi              #
    ###############################
    ombi:
        image: linuxserver/ombi
        container_name: ombi
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        networks:
            - proxy
        environment:
            - PUID=1000
            - PGID=1000
            - TZD
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.ombi.rule=Host(`requests.${ROOT_DOMAIN}`)"
            - "traefik.http.routers.ombi.entrypoints=secure"
            - "traefik.http.routers.ombi.tls=true"
        volumes:
            - ${SERVICES_ROOT}/${OMBI_ROOT:-ombi}:/config
        restart: unless-stopped

    ###############################
    #        Calibre              #
    ###############################
    calibre-web:
        image: technosoft2000/calibre-web
        container_name: calibre-web
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        restart: unless-stopped
        networks:
            - proxy
        environment:
            - PGID=1000
            - PUID=1000
            - USE_CONFIG_DIR=true
        expose:
            - 8083
        volumes:
            - /etc/localtime:/etc/localtime:ro
            - ${BOOKS_ROOT}:/books
            - ${SERVICES_ROOT}/${CALIBRE_WEB_ROOT:-calibre-web}/config:/calibre-web/config
            - ${SERVICES_ROOT}/${CALIBRE_WEB_ROOT:-calibre-web}/kindlegen:/calibre-web/kindlegen
            - ${SERVICES_ROOT}/${CALIBRE_WEB_ROOT:-calibre-web}/app:/calibre-web/app
            - ${SERVICES_ROOT}/${CALIBRE_WEB_ROOT:-calibre-web}/db:/calibre-web/db
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.calibre-web.rule=Host(`library.${ROOT_DOMAIN}`)"
            - "traefik.http.routers.calibre-web.entrypoints=secure"
            - "traefik.http.services.calibre-web.loadbalancer.server.port=8083"
            - "traefik.http.routers.calibre-web.tls=true"

    ###############################
    #           Wekan             #
    ###############################
    wekan-db:
        image: mongo:latest
        container_name: wekan-db
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        restart: always
        command: mongod --oplogSize 128
        networks:
            - proxy
            - wekan
        expose:
            - 27017
        volumes:
            - ${SERVICES_ROOT}/${WEKAN_ROOT:-wekan}/db:/data/db
            - ${SERVICES_ROOT}/${WEKAN_ROOT:-wekan}/db-dump:/dump
    wekan:
        image: mquandalle/wekan
        container_name: wekan-app
        restart: always
        networks:
            - proxy
            - wekan
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.wekan.rule=Host(`boards.${ROOT_DOMAIN}`)"
            - "traefik.http.routers.wekan.entrypoints=secure"
            - "traefik.http.services.wekan.loadbalancer.server.port=8080"
            - "traefik.http.routers.wekan.tls=true"
        environment:
            #- DEBUG=true
            - MONGO_URL=mongodb://wekan-db:27017/wekan
            - ROOT_URL=https://boards.${ROOT_DOMAIN}
            - MAIL_URL=smtp
            - MAIL_FROM=notifications@${ROOT_DOMAIN}
            - WITH_API=true
            - RICHER_CARD_COMMENT_EDITOR=true
            - SCROLLINERTIA=0
            - SCROLLAMOUNT=auto
            - CARD_OPENED_WEBHOOK_ENABLED=false
            - CORS=*
            - CORS_ALLOW_HEADERS=Authorization,Content-Type
            - CORS_EXPOSE_HEADERS=*
            - BROWSER_POLICY_ENABLED=true
            - WEBHOOKS_ATTRIBUTES=cardId,listId,oldListId,boardId,comment,user,card,commentId
            - DEFAULT_AUTHENTICATION_METHOD=ldap
            - LDAP_ENABLE=true
            - LDAP_PORT=389
            - LDAP_HOST=openldap
            - LDAP_BASEDN=ou=people,${LDAP_LOGIN_BASE}
            - LDAP_LOGIN_FALLBACK=false
            - LDAP_RECONNECT=true
            - LDAP_TIMEOUT=10000
            - LDAP_IDLE_TIMEOUT=10000
            - LDAP_CONNECT_TIMEOUT=10000
            - LDAP_AUTHENTIFICATION=true
            - LDAP_AUTHENTIFICATION_USERDN=cn=admin,${LDAP_LOGIN_BASE}
            - LDAP_AUTHENTIFICATION_PASSWORD=${LDAP_ADMIN_PASSWORD}
            - LDAP_LOG_ENABLED=true
            - LDAP_BACKGROUND_SYNC=false
            - LDAP_BACKGROUND_SYNC_INTERVAL='every 1 hour'
            - LDAP_BACKGROUND_SYNC_KEEP_EXISTANT_USERS_UPDATED=false
            - LDAP_BACKGROUND_SYNC_IMPORT_NEW_USERS=false
            - LDAP_ENCRYPTION=false
            - LDAP_USER_AUTHENTICATION_FIELD="uid"
            - LDAP_USER_SEARCH_FIELD=uid
            - LDAP_USERNAME_FIELD=uid
            - LDAP_FULLNAME_FIELD=displayName
            - LDAP_SYNC_ADMIN_STATUS=true
            - LDAP_SYNC_ADMIN_GROUPS=administrator
        depends_on:
            - wekan-db
   
    ###############################
    #           Duplicati         #
    ###############################
    duplicati:
        image: linuxserver/duplicati
        container_name: duplicati
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        environment:
            - PUID=1000
            - PGID=1000
            - TZ
        volumes:
            - ${SERVICES_ROOT}/${DUPLCATI_ROOT:-duplicati}/config:/config
            - ${SERVICES_ROOT}/${DUPLCATI_ROOT:-duplicati}/backups:/backups
            - ${SERVICES_ROOT}/${DUPLCATI_ROOT:-duplicati}/source:/source
        restart: unless-stopped

    ###############################
    #         Transmission        #
    ###############################
    transmission:
        image: linuxserver/transmission
        container_name: transmission
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        restart: unless-stopped
        depends_on:
            - traefik
        networks:
            - proxy
            - exporters
        environment:
            - PUID=${UID:-1000}
            - PGID=${GID:-1000}
            - TZ
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.transmission.rule=Host(`torrent.${ROOT_DOMAIN}`)"
            - "traefik.http.routers.transmission.entrypoints=secure"
            - "traefik.http.services.transmission.loadbalancer.server.port=9091"
            - "traefik.http.routers.transmission.tls=true"
        volumes:
            - ${SERVICES_ROOT}/${TRANSMISSION_ROOT:-transmission}/config:/config
            - ${DOWNLOADS_ROOT}:/downloads
            - ${SERVICES_ROOT}/${TRANSMISSION_ROOT:-transmission}/torrentfiles:/watch

    transmission-exporter:
        image: metalmatze/transmission-exporter
        container_name: transmission-exporter
        restart: always
        networks:
            - exporters
        expose:
            - 19091
        environment:
            TRANSMISSION_ADDR: http://transmission:9091

    ###############################
    #         Guacamole           #
    ###############################
    # https://guacamole.apache.org/doc/gug/guacamole-docker.html
    guacamole:
        image: guacamole/guacamole
        container_name: guacamole
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        restart: unless-stopped
        networks:
            - proxy
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.guacamole.rule=Host(`desktop.${ROOT_DOMAIN}`)"
            - "traefik.http.routers.guacamole.entrypoints=secure"
            - "traefik.http.services.guacamole.loadbalancer.server.port=8080"
            - "traefik.http.routers.guacamole.tls=true"
            - "traefik.http.routers.guacamole.middlewares=guacamole@file"
        environment:
            - LDAP_HOSTNAME=openldap
            - LDAP_PORT
            - LDAP_ENCRYPTION_METHOD
            - LDAP_USER_BASE_DN=ou=people,${LDAP_LOGIN_BASE}
            - LDAP_SEARCH_BIND_DN=cn=admin,${LDAP_LOGIN_BASE}
            - LDAP_SEARCH_BIND_PASSWORD=${LDAP_ADMIN_PASSWORD}
            - LDAP_USERNAME_ATTRIBUTE=uid
            - GUACD_HOSTNAME=guacd

    guacd:
        image: guacamole/guacd
        container_name: guacd
        restart: unless-stopped
        expose:
            - 4822
        networks:
            - proxy

    ###############################
    #         Cyberchef           #
    ###############################
    cyberchef:
        image: mpepping/cyberchef
        restart: unless-stopped
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        container_name: cyberchef
        networks:
            - proxy
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.cyberchef.rule=Host(`chef.${ROOT_DOMAIN}`)"
            - "traefik.http.routers.cyberchef.entrypoints=secure"
            - "traefik.http.services.cyberchef.loadbalancer.server.port=8000"
            - "traefik.http.routers.cyberchef.tls=true"

    ###############################
    #         Statping            #
    ###############################
    statping:
        container_name: statping
        image: statping/statping:latest
        networks:
            - proxy
        restart: always
        
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        volumes:
            - statping_data:/app
        environment:
            DB_CONN: sqlite
        ports:
            - 8080:8080
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.statping.rule=Host(`ping.${ROOT_DOMAIN}`)"
            - "traefik.http.routers.statping.entrypoints=secure"
            - "traefik.http.services.statping.loadbalancer.server.port=8080"
            - "traefik.http.routers.statping.tls=true"

    ###############################
    #         Radarr              #
    ###############################
    radarr:
        image: linuxserver/radarr
        container_name: radarr
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        networks:
            - proxy
        environment:
            - PUID=1000
            - PGID=1000
            - TZ
            - UMASK_SET=022 #optional
        volumes:
            - ${SERVICES_ROOT}/${RADARR_ROOT:-radarr}/config:/config
            - ${MOVIES_ROOT}:/movies
            - ${DOWNLOADS_ROOT}:/downloads
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.radarr.rule=Host(`radarr.${ROOT_DOMAIN}`)"
            - "traefik.http.routers.radarr.entrypoints=secure"
            - "traefik.http.services.radarr.loadbalancer.server.port=7878"
            - "traefik.http.routers.radarr.middlewares=authelia@file"
            - "traefik.http.routers.radarr.tls=true"
        restart: unless-stopped

    ###############################
    #         Lidarr              #
    ###############################
    lidarr:
        image: linuxserver/lidarr
        container_name: lidarr
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        networks:
            - proxy
        environment:
            - PUID=1000
            - PGID=1000
            - TZ
            - UMASK_SET=022 #optional
        volumes:
            - ${SERVICES_ROOT}/${LIDARR_ROOT:-lidarr}/config:/config
            - ${MUSIC_ROOT}:/music
            - ${DOWNLOADS_ROOT}:/downloads
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.lidarr.rule=Host(`lidarr.${ROOT_DOMAIN}`)"
            - "traefik.http.routers.lidarr.entrypoints=secure"
            - "traefik.http.services.lidarr.loadbalancer.server.port=8686"
            - "traefik.http.routers.lidarr.middlewares=authelia@file"
            - "traefik.http.routers.lidarr.tls=true"
        restart: unless-stopped

    ###############################
    #         Sonarr              #
    ###############################
    sonarr:
        image: linuxserver/sonarr
        container_name: sonarr
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        networks:
            - proxy
        environment:
            - PUID=1000
            - PGID=1000
            - TZ
            - UMASK_SET=022 #optional
        volumes:
            - ${SERVICES_ROOT}/${SONARR_ROOT:-sonarr}/config:/config
            - ${TV_ROOT}:/tv
            - ${DOWNLOADS_ROOT}:/downloads
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.sonarr.rule=Host(`sonarr.${ROOT_DOMAIN}`)"
            - "traefik.http.routers.sonarr.entrypoints=secure"
            - "traefik.http.services.sonarr.loadbalancer.server.port=8989"
            - "traefik.http.routers.sonarr.middlewares=authelia@file"
            - "traefik.http.routers.sonarr.tls=true"
        restart: unless-stopped

    ###############################
    #         Jackett             #
    ###############################
    jackett:
        image: linuxserver/jackett
        container_name: jackett
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        networks:
            - proxy
        environment:
            - PUID=1000
            - PGID=1000
            - TZ
            # - RUN_OPTS=<run options here> #optional
        volumes:
            - ${SERVICES_ROOT}/${JACKETT_ROOT:-jackett}/config:/config
            - ${DOWNLOADS_ROOT}:/downloads
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.jackett.rule=Host(`jackett.${ROOT_DOMAIN}`)"
            - "traefik.http.routers.jackett.entrypoints=secure"
            - "traefik.http.services.jackett.loadbalancer.server.port=9117"
            - "traefik.http.routers.jackett.middlewares=authelia@file"
            - "traefik.http.routers.jackett.tls=true"
        restart: unless-stopped

    ###############################
    #         Beets               #
    ###############################
    beets:
        image: linuxserver/beets
        container_name: beets
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        environment:
            - PUID=1000
            - PGID=1000
            - TZ
        volumes:
            - ${SERVICES_ROOT}/${BEETS_ROOT:-beets}/config:/config
            - ${MUSIC_ROOT}:/music
            - ${DOWNLOADS_ROOT}:/downloads
        networks:
            - proxy
        ports:
            - 8337:8337
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.beets.rule=Host(`beets.${ROOT_DOMAIN}`)"
            - "traefik.http.routers.beets.entrypoints=secure"
            - "traefik.http.services.beets.loadbalancer.server.port=8337"
            - "traefik.http.routers.beets.middlewares=authelia@file"
            - "traefik.http.routers.beets.tls=true"
        restart: unless-stopped

    ###############################
    #         Tdarr               #
    ###############################
    tdarr:
        image: haveagitgat/tdarr_aio
        container_name: tdarr
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        networks:
            - proxy
        volumes:
            - ${SERVICES_ROOT}/${TDARR_ROOT:-tdarr}/data:/home/Tdarr/Documents/Tdarr
            - ${SERVICES_ROOT}/${TDARR_ROOT:-tdarr}/cache:/home/Tdarr/cache
            - ${SERVICES_ROOT}/${TDARR_ROOT:-tdarr}/db:/var/lib/mongodb
            - ${MOVIES_ROOT}:/home/Tdarr/Media/movies
            - ${TV_ROOT}:/home/Tdarr/Media/tv
            - /etc/localtime:/etc/localtime:ro
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.tdarr.rule=Host(`tdarr.${ROOT_DOMAIN}`)"
            - "traefik.http.routers.tdarr.entrypoints=secure"
            - "traefik.http.services.tdarr.loadbalancer.server.port=8265"
            - "traefik.http.routers.tdarr.middlewares=authelia@file"
            - "traefik.http.routers.tdarr.tls=true"
        restart: unless-stopped

    ###############################
    #         SABNZBD             #
    ###############################
    sabnzbd:
        image: linuxserver/sabnzbd:latest
        container_name: sabnzbd
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        networks:
            - proxy
        environment:
            - PUID=1000
            - PGID=1000
            - TZ
        volumes:
            - ${SERVICES_ROOT}/${SABNZBD_ROOT:-sabnzbd}/config:/config
            - ${SERVICES_ROOT}/${SABNZBD_ROOT:-sabnzbd}/intermediate:/intermediate
            - ${DOWNLOADS_ROOT}:/downloads
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.sabnzbd.rule=Host(`newsreader.${ROOT_DOMAIN}`)"
            - "traefik.http.routers.sabnzbd.entrypoints=secure"
            - "traefik.http.services.sabnzbd.loadbalancer.server.port=8080"
            - "traefik.http.routers.sabnzbd.middlewares=authelia@file"
            - "traefik.http.routers.sabnzbd.tls=true"
        restart: unless-stopped

    ###############################
    #         Syncthing           #
    ###############################
    syncthing:
        image: linuxserver/syncthing
        container_name: syncthing
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        networks:
            - proxy
        environment:
            - PUID=1000
            - PGID=1000
            - TZ
            - UMASK_SET=022
        volumes:
            - ${SERVICES_ROOT}/${SYNCTHING_ROOT:-syncthing}/config:/config
            - ${MOVIES_ROOT}:/movies
            - ${TV_ROOT}:/tv
            - ${BOOKS_ROOT}:/books
            - ${MUSIC_ROOT}:/music
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.syncthing.rule=Host(`sync.${ROOT_DOMAIN}`)"
            - "traefik.http.routers.syncthing.entrypoints=secure"
            - "traefik.http.services.syncthing.loadbalancer.server.port=8384"
            - "traefik.http.routers.syncthing.middlewares=authelia@file"
            - "traefik.http.routers.syncthing.tls=true"
        ports:
            - 22000:22000
            - 21027:21027/udp
        restart: unless-stopped

    ###############################
    #         Bazarr              #
    ###############################
    bazarr:
        image: linuxserver/bazarr
        container_name: bazarr
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        networks:
            - proxy
        environment:
          - PUID=1000
          - PGID=1000
          - TZ
        volumes:
          - ${SERVICES_ROOT}/${BAZARR_ROOT:-bazzar}/config:/config
          - ${MOVIES_ROOT}:/movies
          - ${TV_ROOT}:/tv
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.bazarr.rule=Host(`bazarr.${ROOT_DOMAIN}`)"
            - "traefik.http.routers.bazarr.entrypoints=secure"
            - "traefik.http.services.bazarr.loadbalancer.server.port=6767"
            - "traefik.http.routers.bazarr.middlewares=authelia@file"
            - "traefik.http.routers.bazarr.tls=true"
        restart: unless-stopped

    # ##############################
    # #        Exportarr           #
    # ##############################
    # sonarr-exporter:
    #     image: onedr0p/exportarr
    #     container_name: sonarr-exporter
    #     restart: unless-stopped
    #     command: ["exportarr", "sonarr"]
    #     networks:
    #         - exporters
    #     environment:
    #         PORT: 9707
    #         URL: "http://sonarr:8989"
    #         APIKEY: ${SONARR_API_KEY}
    #         ENABLE_EPISODE_QUALITY_METRICS: "false"
    #         DISABLE_SSL_VERIFY: "true"
    #     expose:
    #         - 9707

    # radarr-exporter:
    #     image: onedr0p/exportarr
    #     container_name: radarr-exporter
    #     restart: unless-stopped
    #     command: ["exportarr", "radarr"]
    #     networks:
    #         - exporters
    #     environment:
    #         PORT: 9708
    #         URL: "http://radarr:7878"
    #         APIKEY: ${RADARR_API_KEY}
    #         DISABLE_SSL_VERIFY: "true"
    #     expose:
    #         - 9708

    ##############################
    #        Booksonic           #
    ##############################
    booksonic:
        image: linuxserver/booksonic
        container_name: booksonic
        environment:
            - PUID=1000
            - PGID=1000
            - TZ
            - CONTEXT_PATH=audiobooks.${ROOT_DOMAIN}
        logging:
            driver: "loki"
            options:
                loki-url: "http://localhost:3100/loki/api/v1/push"
        volumes:
            - ${SERVICES_ROOT}/${BOOKSONIC_ROOT:-booksonic}/config:/config
            - ${AUDIOBOOKS_ROOT}:/audiobooks
            - ${PODCASTS_ROOT}:/podcasts
        restart: unless-stopped
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.booksonic.rule=Host(`audiobooks.${ROOT_DOMAIN}`)"
            - "traefik.http.routers.booksonic.entrypoints=secure"
            - "traefik.http.services.booksonic.loadbalancer.server.port=4040"
            - "traefik.http.routers.booksonic.tls=true"